#!/bin/sh

# Memoria en uso y libre
mem=$(free -m | awk '/^Mem:/ {print $3" Busy/"$2" Free"}')

# Información del kernel
kernel=$(uname -r)
kernelsize=$(du -sh /boot/vmlinuz-${kernel} | awk '{print $1}')

# Cargar información de la distribución
. /etc/os-release
hn=$(cat /etc/hostname)
os=${PRETTY_NAME}

# Información del CPU
cpu=$(awk -F ": " 'NR==5 {print $2}' /proc/cpuinfo)

# Información de la GPU
gpu=$(lspci | grep -i vga | awk -F' ' '{print $5}')

# Tiempo de actividad del sistema
time=$(uptime -p | awk '{print $0}')

# Número de paquetes instalados en Gentoo (usando qlist)
spkg=$(qlist -Iv | wc -l)

# Función para obtener la versión de un paquete
get_version() {
  local package="$1"
  version=$(qlist -Iv "$package" | head -n 1 | awk -F'/' '{print $2}')
  echo "$version"
}

# Información de los paquetes instalados
wm=$(get_version dwm)
font=$(get_version "x11-libs/gtk+")
mksh=$(get_version mksh)
shell=$(basename $SHELL)
nvidia=$(get_version "x11-drivers/nvidia-drivers")
x11=$(get_version x11-base/xorg-server)
snd=$(get_version media-libs/alsa-lib)
sndservice=$(get_version media-video/pipewire)
init=$(get_version sys-apps/openrc)
tr=$(get_version x11-terms/urxvt)
glibc=$(get_version sys-libs/glibc)
gcc=$(get_version sys-devel/gcc)
binut=$(get_version sys-devel/binutils)
pyth=$(get_version dev-lang/python)
samu=$(get_version dev-util/ninja)
clan=$(get_version dev-lang/clang)
llvm=$(get_version dev-libs/llvm)

# Función que imprime la información utilizando printf
full() {
  printf "-> бритва\n"
  printf "-> %s\n" "$os"
  printf "-> kernel-%s (%s)\n" "$kernel" "$kernelsize"
  printf "-> openrc-%s\n" "$init"
  printf "-> cpu %s\n" "$cpu"
  printf "-> ram %s\n" "$(free -h | awk '/^Mem:/ {print $3" Used / " $2" Total"})"
  printf "-> %s\n" "$mem"
  printf "-> %s\n" "$gpu"
  printf "-> gpu driver %s\n" "$nvidia"
  printf "-> uptime-%s\n" "$time"
  printf "-> spkg: %s\n" "$spkg"
  printf "-> dwm-%s\n" "$wm"
  printf "-> %s\n" "$font"
  printf "-> %s %s\n" "$shell" "$mksh"
  printf "-> xorg-server-%s\n" "$x11"
  printf "-> alsa-%s\n" "$snd"
  printf "-> pipewire-%s\n" "$sndservice"
  printf "-> urxvt-%s\n" "$tr"
  printf "-> glibc-%s\n" "$glibc"
  printf "-> gcc-%s\n" "$gcc"
  printf "-> binutils-%s\n" "$binut"
  printf "-> python-%s\n" "$pyth"
  printf "-> llvm-%s\n" "$llvm"
  printf "-> samurai-%s\n" "$samu"
  printf "-> clang-%s\n" "$clan"
}

# Llamar a la función para imprimir la información
full
