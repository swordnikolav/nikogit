#!/bin/mksh
# generate_scripts_dump.sh - Dumps all scripts from ~/.local/bin/ into a single file
# Uso: ./generate_scripts_dump.sh [output_file]  # Default: ~/scripts_dump.txt

set -e  # Exit on error

DUMP_FILE="${1:-$HOME/scripts_dump.txt}"
SCRIPTS_DIR="$HOME/.local/bin"

echo "=== DUMP DE SCRIPTS - $(date) ===" > "$DUMP_FILE"
echo "Directorio escaneado: $SCRIPTS_DIR" >> "$DUMP_FILE"
echo "Archivos encontrados: $(find "$SCRIPTS_DIR" -maxdepth 1 -type f -executable | wc -l)" >> "$DUMP_FILE"
echo "" >> "$DUMP_FILE"

TOTAL=0
for script in "$SCRIPTS_DIR"/*; do
    if [[ -f "$script" && -x "$script" ]]; then
        TOTAL=$((TOTAL + 1))
        echo "=== SCRIPT $TOTAL: $(basename "$script") ===" >> "$DUMP_FILE"
        echo "Shebang: $(head -n1 "$script" 2>/dev/null || echo 'N/A')" >> "$DUMP_FILE"
        echo "" >> "$DUMP_FILE"
        cat "$script" >> "$DUMP_FILE"
        echo "" >> "$DUMP_FILE"
        echo "--- FIN DE $(basename "$script") ---" >> "$DUMP_FILE"
        echo "" >> "$DUMP_FILE"
    fi
done

echo "Dump completado! Archivo: $DUMP_FILE (total scripts: $TOTAL)"
echo "Ejemplo de uso: cat '$DUMP_FILE' | head -50"  # Para preview r√°pido
