#!/bin/sh

netstat -ntu | grep ESTAB | awk '{split($5, a, ":"); print a[1]}' | sed -e 's/::ffff://' > ips.txt

while read -r ip; do
  hostname=$(dig +short -x "$ip")

  isp=$(whois "$ip" | awk -F':' '/^OrgName/ {print $2}')

  echo "IP: $ip - Hostname: $hostname - ISP: $isp"

done < ips.txt
